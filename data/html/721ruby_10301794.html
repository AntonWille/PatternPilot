 <h2> Title: Difference between rake db:migrate db:reset and db:schema:load </h2> <h4> Gaurav Agarwal, question_id: 10301794 </h4>Score: 721, Tags: {ruby-on-rails,ruby,database,rake} <br><p>The difference between <code>rake db:migrate</code> and <code>rake db:reset</code> is pretty clear to me. The thing which I don't understand is how <code>rake db:schema:load</code> is different from the former two.</p>
<p>Just to be sure that I am on the same page:</p>
<ul>
<li><code>rake db:migrate</code> - Runs the migrations which haven't been run yet.</li>
<li><code>rake db:reset</code> - Clears the database (presumably does a <code>rake db:drop</code> + <code>rake db:create</code> + <code>rake db:migrate</code>) and runs migration on a fresh database.</li>
</ul>
<h4> zx1986, Id: 42850647 Score: 13: </h4>Does <code>rake --tasks</code> help ?<br><h4> Purplejacket, Id: 102176930 Score: 2: </h4>BTW, as of Rails 5, these commands can be invoked as <code>rails db:migrate</code>, <code>rails db:reset</code>, <code>rails db:schema:load</code>.  See <a href="https://stackoverflow.com/questions/38403533/rails-dbmigrate-vs-rake-dbmigrate" title="rails dbmigrate vs rake dbmigrate">stackoverflow.com/questions/38403533/&hellip;</a><br><h4> Magne, Id: 75872789 Score: 0: </h4>Your understanding of <code>rake db:migrate</code> is correct, but your understanding of <code>rake db:reset</code> is wrong. See the topmost answer, from moritz.<br><h4> Bishisht Bhatta, Id: 61565764 Score: 0: </h4>You should check this blog. <a href="http://jacopretorius.net/2014/02/all-rails-db-rake-tasks-and-what-they-do.html" rel="nofollow noreferrer">jacopretorius.net/2014/02/&hellip;</a><br>------------------------------------------------------------------ <br><h3> moritz, Id: 10302357, Score: 1518: </h3><ul>
<li><p><strong>db:migrate</strong> runs (single) migrations that have not run yet.</p>
</li>
<li><p><strong>db:create</strong> creates the database</p>
</li>
<li><p><strong>db:drop</strong> deletes the database</p>
</li>
<li><p><strong>db:schema:load</strong> creates tables and columns within the existing database following schema.rb. This will delete existing data.</p>
</li>
<li><p><strong>db:setup</strong> does db:create, db:schema:load, db:seed</p>
</li>
<li><p><strong>db:reset</strong> does db:drop, db:setup</p>
</li>
<li><p><strong>db:migrate:reset</strong> does db:drop, db:create, db:migrate</p>
</li>
</ul>
<p>Typically, you would use db:migrate after having made changes to the schema via new migration files (this makes sense only if there is already data in the database). db:schema:load is used when you setup a new instance of your app.</p>
<hr />
<h2>For rails 3.2.12:</h2>
<p>I just checked the source and the dependencies are like this now:</p>
<ul>
<li><p><strong>db:create</strong> creates the database for the current env</p>
</li>
<li><p><strong>db:create:all</strong> creates the databases for all envs</p>
</li>
<li><p><strong>db:drop</strong> drops the database for the current env</p>
</li>
<li><p><strong>db:drop:all</strong> drops the databases for all envs</p>
</li>
<li><p><strong>db:migrate</strong> runs migrations for the current env that have not run yet</p>
</li>
<li><p><strong>db:migrate:up</strong> runs one specific migration</p>
</li>
<li><p><strong>db:migrate:down</strong> rolls back one specific migration</p>
</li>
<li><p><strong>db:migrate:status</strong> shows current migration status</p>
</li>
<li><p><strong>db:rollback</strong> rolls back the last migration</p>
</li>
<li><p><strong>db:forward</strong> advances the current schema version to the next one</p>
</li>
<li><p><strong>db:seed</strong> (only) runs the db/seed.rb file</p>
</li>
<li><p><strong>db:schema:load</strong> loads the schema into the current env's database</p>
</li>
<li><p><strong>db:schema:dump</strong> dumps the current env's schema (and seems to create the db as well)</p>
</li>
<li><p><strong>db:setup</strong> runs db:create db:schema:load db:seed</p>
</li>
<li><p><strong>db:reset</strong> runs db:drop db:setup</p>
</li>
<li><p><strong>db:migrate:redo</strong> runs (db:migrate:down db:migrate:up) or (db:rollback db:migrate) depending on the specified migration</p>
</li>
<li><p><strong>db:migrate:reset</strong> runs db:drop db:create db:migrate</p>
</li>
</ul>
<p>For further information please have a look at <a href="https://github.com/rails/rails/blob/v3.2.12/activerecord/lib/active_record/railties/databases.rake" rel="noreferrer">https://github.com/rails/rails/blob/v3.2.12/activerecord/lib/active_record/railties/databases.rake</a> (for Rails 3.2.x) and <a href="https://github.com/rails/rails/blob/v4.0.5/activerecord/lib/active_record/railties/databases.rake" rel="noreferrer">https://github.com/rails/rails/blob/v4.0.5/activerecord/lib/active_record/railties/databases.rake</a> (for Rails 4.0.x)</p>
<h4> cutalion, Comment 13258647 Score: 23: </h4>Here is the file with answers :) - <a href="https://github.com/rails/rails/blob/master/activerecord/lib/active_record/railties/databases.rake" rel="nofollow noreferrer">github.com/rails/rails/blob/master/activerecord/lib/&hellip;</a><br><h4> moritz, Comment 13274051 Score: 3: </h4>@cutation: db:setup does surely not run db:migrate, because it would be much too brittle to run all migrations just for a db setup (this is what schema.rb is for).<br><h4> Alejandro Riedel, Comment 20734813 Score: 2: </h4>I&#39;m executing db:reset and it&#39;s seeding my db. Why could it be?<br><h4> Dan, Comment 32915682 Score: 1: </h4><b>db:setup</b> also runs <code>db:create</code> if necessary.  At least as of rails 4.0.2.<br><h4> Pooyan Khosravi, Comment 41949383 Score: 0: </h4>Rails 4 will perform <code>rake db:migrate</code> when calling <code>rake db:setup</code> if there are pending migrations but won&#39;t execute pending migrations.<br><h4> Fred Willmore, Comment 63148611 Score: 0: </h4>As of Rails 5, you can run rake tasks with the <code>rails</code> keyword - eg <code>rails db:migrate</code><br><h4> ian, Comment 101884435 Score: 0: </h4>I just ran <code>rake db:setup</code> for a new Rails v6.0.0 project and got the message &quot;db/schema.rb doesn&#39;t exist yet. Run <code>rails db:migrate</code> to create it, then try again&quot;, so it seems it doesn&#39;t run <code>db:migrate</code> for this version.<br><h4> Chris Scott, Comment 107451771 Score: 0: </h4>Was not aware of <code>db:migrate:reset</code>, and it ended up being exactly what I needed. Thanks!<br><h4> Ridhwaan Shakeel, Comment 114337084 Score: 0: </h4>does <code>db:setup</code> also create the users/roles?<br><h4> jshah, Comment 116599267 Score: 0: </h4>just fyi: <code>db:setup</code> will drop your local development database. <code>db:setup</code> ends up running <code>db:schema:load_if_ruby</code> which runs <code>db:schema:load</code>. This reloads the current schema that purges all your current data in the database.<br><h4> stevec, Comment 117428059 Score: 0: </h4>Please consider adding the newer answer to the top, and older answer to the bottom, as rails 3.x is quite old now<br><h4> Hellfar, Comment 117655025 Score: 0: </h4>Seems that <code>db:setup</code> also do a <code>db:drop</code> ?? My db got &quot;reset&quot; every time I do a <code>db:setup</code> :/ ...<br>------------------------------------------------------------------ <br><h3> sudo bangbang, Id: 36469145, Score: 27: </h3><h2>TLDR</h2>
<p>Use</p>
<ul>
<li><code>rake db:migrate</code> If you wanna make changes to the schema</li>
<li><code>rake db:reset</code> If you wanna drop the database, reload the schema from <code>schema.rb</code>, and reseed the database</li>
<li><code>rake db:schema:load</code> If you wanna reset database to schema as provided in <code>schema.rb</code> (This will delete all data)</li>
</ul>
<h2>Explanations</h2>
<p><code>rake db:schema:load</code> will set up the schema as provided in <code>schema.rb</code> file. This is useful for a fresh install of app as it doesn't take as much time as <code>db:migrate</code></p>
<blockquote>
<p>Important note, <code>db:schema:load</code> will <strong>delete</strong> data on server.</p>
</blockquote>
<p><code>rake db:migrate</code> makes changes to the existing schema. Its like creating versions of schema. <code>db:migrate</code> will look in <code>db/migrate/</code> for any ruby files and execute the migrations that aren't run yet starting with the oldest. Rails knows which file is the oldest by looking at the timestamp at the beginning of the migration filename. <code>db:migrate</code> comes with a benefit that data can also be put in the database. This is actually not a good practice. Its better to use <code>rake db:seed</code> to add data.</p>
<p><code>rake db:migrate</code> provides tasks <a href="https://github.com/rails/rails/blob/master/activerecord/lib/active_record/railties/databases.rake#L93" rel="noreferrer">up</a>, <a href="https://github.com/rails/rails/blob/master/activerecord/lib/active_record/railties/databases.rake#L100" rel="noreferrer">down</a> etc which enables commands like <code>rake db:rollback</code> and makes it the most useful command.</p>
<p><code>rake db:reset</code> does a <code>db:drop</code> and <code>db:setup</code><br />
It drops the database, create it again, loads the schema, and initializes with the seed data</p>
<h3>Relevant part of the commands from <a href="https://github.com/rails/rails/blob/master/activerecord/lib/active_record/railties/databases.rake" rel="noreferrer">databases.rake</a></h3>
<hr />
<pre><code>namespace :schema do
  desc 'Creates a db/schema.rb file that is portable against any DB supported by Active Record'
  task :dump =&gt; [:environment, :load_config] do
    require 'active_record/schema_dumper'
    filename = ENV['SCHEMA'] || File.join(ActiveRecord::Tasks::DatabaseTasks.db_dir, 'schema.rb')
    File.open(filename, &quot;w:utf-8&quot;) do |file|
      ActiveRecord::SchemaDumper.dump(ActiveRecord::Base.connection, file)
    end
    db_namespace['schema:dump'].reenable
  end

  desc 'Loads a schema.rb file into the database'
  task :load =&gt; [:environment, :load_config, :check_protected_environments] do
    ActiveRecord::Tasks::DatabaseTasks.load_schema_current(:ruby, ENV['SCHEMA'])
  end
</code></pre>
<hr />
<pre><code>  # desc 'Drops and recreates the database from db/schema.rb for the current environment and loads the seeds.'
  task :reset =&gt; [ 'db:drop', 'db:setup' ]
</code></pre>
<hr />
<pre><code>namespace :migrate do
  # desc  'Rollbacks the database one migration and re migrate up (options: STEP=x, VERSION=x).'
  task :redo =&gt; [:environment, :load_config] do
    if ENV['VERSION']
      db_namespace['migrate:down'].invoke
      db_namespace['migrate:up'].invoke
    else
      db_namespace['rollback'].invoke
      db_namespace['migrate'].invoke
    end
  end
</code></pre>
<h4> user3096803, Comment 71671366 Score: 0: </h4>So if you create your production schema using db:schema:load(created from a series of previous migrations), will rake know which migrations(the ones which took part in creating the initial schema.rb) do not need to be run on future invocations of db:migrate?<br>------------------------------------------------------------------ <br><h3> Ivan Skotsyk, Id: 61587667, Score: 14: </h3><h1>Rails 5</h1>
<p><code>db:create</code> - Creates the database for the current <strong>RAILS_ENV</strong> environment. If <strong>RAILS_ENV</strong> is not specified it defaults to the development and test databases.</p>
<p><code>db:create:all</code> - Creates the database for all environments.</p>
<p><code>db:drop</code> - Drops the database for the current <strong>RAILS_ENV</strong> environment. If <strong>RAILS_ENV</strong> is not specified it defaults to the development and test databases.</p>
<p><code>db:drop:all</code> - Drops the database for all environments.</p>
<p><code>db:migrate</code> - Runs migrations for the current environment that have not run yet. By default it will run migrations only in the development environment.</p>
<p><code>db:migrate:redo</code> - Runs <strong>db:migrate:down</strong> and <strong>db:migrate:up</strong> or <strong>db:migrate:rollback</strong> and <strong>db:migrate:up</strong> depending on the specified migration.</p>
<p><code>db:migrate:up</code> - Runs the up for the given migration VERSION.</p>
<p><code>db:migrate:down</code> - Runs the down for the given migration VERSION.</p>
<p><code>db:migrate:status</code> - Displays the current migration status.</p>
<p><code>db:migrate:rollback</code> - Rolls back the last migration.</p>
<p><code>db:version</code> - Prints the current schema version.</p>
<p><code>db:forward</code> - Pushes the schema to the next version.</p>
<p><code>db:seed</code> - Runs the <strong>db/seeds.rb</strong> file.</p>
<p><code>db:schema:load</code> Recreates the database from the <strong>schema.rb</strong> file. <strong>Deletes existing data.</strong></p>
<p><code>db:schema:dump</code> Dumps the current environment’s schema to <strong>db/schema.rb</strong>.</p>
<p><code>db:structure:load</code> - Recreates the database from the <strong>structure.sql</strong> file.</p>
<p><code>db:structure:dump</code> - Dumps the current environment’s schema to <strong>db/structure.sql</strong>.
(You can specify another file with <code>SCHEMA=db/my_structure.sql</code>)</p>
<p><code>db:setup</code> Runs <strong>db:create</strong>, <strong>db:schema:load</strong> and <strong>db:seed</strong>.</p>
<p><code>db:reset</code> Runs <strong>db:drop</strong> and <strong>db:setup</strong>.
<code>db:migrate:reset</code> - Runs <strong>db:drop</strong>, <strong>db:create</strong> and <strong>db:migrate</strong>.</p>
<p><code>db:test:prepare</code> - Check for pending migrations and load the test schema. (If you run rake without any arguments it will do this by default.)</p>
<p><code>db:test:clone</code> - Recreate the test database from the current environment’s database schema.</p>
<p><code>db:test:clone_structure</code> - Similar to <strong>db:test:clone</strong>, but it will ensure that your test database has the same structure, including charsets and collations, as your current environment’s database.</p>
<p><code>db:environment:set</code> - Set the current <strong>RAILS_ENV</strong> environment in the <strong>ar_internal_metadata</strong> table. (Used as part of the protected environment check.)</p>
<p><code>db:check_protected_environments</code> - Checks if a destructive action can be performed in the current <strong>RAILS_ENV</strong> environment. Used internally when running a destructive action such as <strong>db:drop</strong> or <strong>db:schema:load</strong>.</p>
------------------------------------------------------------------ <br><h3> software_writer, Id: 70284656, Score: 3: </h3><h3>List all tasks</h3>
<p>You can find all the database tasks Rails provides by running the following command from a Rails application directory.</p>
<pre class="lang-sh prettyprint-override"><code>➜  blog (main) ✗ bin/rails help | grep db:

db:create
db:drop
...
</code></pre>
<h3>Summary</h3>
<p><strong>db:create</strong>: Creates the database unless it already exists.</p>
<p><strong>db:drop</strong>: Drops the database if it exists.</p>
<p><strong>db:environment:set</strong>: Fixes the <code>EnvironmentMismatchError</code> or <code>NoEnvironmentInSchemaError</code>, raised if the environment data is not found in the schema, by setting the current environment in the internal table.</p>
<p><strong>db:fixtures:load</strong>: It loads the fixtures, i.e., the sample data that you want to test against. They are stored in the YAML file under the <code>test/fixtures/</code> directory.</p>
<p><strong>db:migrate</strong>: Runs all the migrations that have not run yet, for the current environment.</p>
<p><strong>db:migrate:down</strong>: Reverts the transformations performed by the last migration's <code>up</code> method by running the <code>down</code> method.</p>
<p><strong>db:migrate:redo</strong>: Rolls back the database one migration and re-migrates up.</p>
<p><strong>db:migrate:status</strong>: Displays the status of migrations.</p>
<p><strong>db:migrate:up</strong>: Runs the <code>up</code> method for a given migration.</p>
<p><strong>db:prepare</strong>: Runs <code>setup</code> if the database does not exist. Otherwise, it runs the migrations.</p>
<p><strong>db:reset</strong>: Resets your database using your migrations for the current environment. It does this by running the <code>db:drop</code>, <code>db:create</code>, <code>db:migrate</code> tasks.</p>
<p><strong>db:rollback</strong>: Rolls the schema back to the previous version, undoing the migration that you just ran. If you want to undo previous <code>n</code> migrations, pass <code>STEP=n</code> to this task.</p>
<p><strong>db:schema:cache:clear</strong>: Clears the db/schema_cache.yml file generated by the <code>db:schema:cache:dump</code> task.</p>
<p><strong>db:schema:cache:dump</strong>: Creates a db/schema_cache.yml file.</p>
<p><strong>db:schema:dump</strong>: Creates a database schema file (either <code>db/schema.rb</code> or <code>db/structure.sql</code>, depending on <code>config.active_record.schema_format</code>).</p>
<p><strong>db:schema:load</strong>: Loads a database schema file (either <code>db/schema.rb</code> or <code>db/structure.sql</code>, depending on <code>config.active_record.schema_format</code>) into the database.</p>
<p><strong>db:seed</strong>: Loads the seed data from <code>db/seeds.rb</code> file.</p>
<p><strong>db:seed:replant</strong>: Truncates tables of each database for the current environment and loads the seeds</p>
<p><strong>db:setup</strong>: Creates all databases <code>db:create</code>, loads all schemas <code>db:schema:load</code>, and initializes with the seed data <code>db:seed</code>. However, it won't drop the database first if it exists. Use <code>db:reset</code> to also drop all databases first.</p>
<p><strong>db:structure:dump</strong>: Deprecated. It was used to dump the <code>structure.sql</code> file.
<strong>db:structure:load</strong>: Deprecated. It was used to load the <code>structure.sql</code> file.</p>
<blockquote>
<p>For some history behind why these tasks were deprecated, check out this <a href="https://discuss.rubyonrails.org/t/db-schema-vs-db-structure/75406" rel="nofollow noreferrer">wtf</a>. No, <a href="https://weblog.rubyonrails.org/2020/5/7/A-May-of-WTFs/" rel="nofollow noreferrer">seriously</a>.</p>
</blockquote>
<p><strong>db:system:change</strong>: Running <code>rails new</code> generator without specifying a database sets your app with <code>sqlite</code>. It's a hassle to change the database later. This task helps you easily change the database by delegating to the <code>rails db:change SYSTEM=postgresql|mysql|whatever</code> generator.</p>
<p><strong>db:version</strong>: Prints the current schema version number.</p>
<p>Source: <a href="https://akshaykhot.com/rails-database-tasks/" rel="nofollow noreferrer">All the Database Tasks in Rails</a></p>
------------------------------------------------------------------ <br><h3> Simon Bagreev, Id: 10301992, Score: 2: </h3><p>As far as I understand, it is going to drop your database and re-create it based on your <code>db/schema.rb</code> file. That is why you need to make sure that your <code>schema.rb</code> file is always up to date and under version control.</p>
------------------------------------------------------------------ <br><h3> Douglas G. Allen, Id: 28385704, Score: 0: </h3><p>You could simply look in the Active Record Rake tasks as that is where I believe they live as in this file.
<a href="https://github.com/rails/rails/blob/fe1f4b2ad56f010a4e9b93d547d63a15953d9dc2/activerecord/lib/active_record/tasks/database_tasks.rb" rel="nofollow noreferrer">https://github.com/rails/rails/blob/fe1f4b2ad56f010a4e9b93d547d63a15953d9dc2/activerecord/lib/active_record/tasks/database_tasks.rb</a></p>

<p>What they do is your question right?</p>

<p>That depends on where they come from and this is just and example to show that they vary depending upon the task. Here we have a different file full of tasks.</p>

<p><a href="https://github.com/rails/rails/blob/fe1f4b2ad56f010a4e9b93d547d63a15953d9dc2/activerecord/Rakefile" rel="nofollow noreferrer">https://github.com/rails/rails/blob/fe1f4b2ad56f010a4e9b93d547d63a15953d9dc2/activerecord/Rakefile</a></p>

<p>which has these tasks.</p>

<pre><code>namespace :db do
  task create: ["db:mysql:build", "db:postgresql:build"]
  task drop: ["db:mysql:drop", "db:postgresql:drop"]
end
</code></pre>

<p>This may not answer your question but could give you some insight into go ahead and look the source over especially the rake files and tasks. As they do a pretty good job of helping you use rails they don't always document the code that well. We could all help there if we know what it is supposed to do.</p>
<h4> PhilT, Comment 69068324 Score: 0: </h4>Please quote relevant parts of the article in case it is removed. Don&#39;t suggest doing something without explaining why.<br>