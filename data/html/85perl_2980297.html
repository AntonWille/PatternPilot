 <h2> Title: How can I use CPAN as a non-root user? </h2> <h3> Juan A. Navarro, question_id: 2980297 </h3>Score: 85, Tags: {perl,cpan} <br><p>I want to install perl modules on a shared server on which I do not have root access. How can I do this? They also seem to have an older version of CPAN (it complains about that when running the command), is it possible to update the CPAN command being used from my account without requiring root access?</p>
<h4> Comment 6800841 daxim: </h4>possible duplicate of <a href="http://stackoverflow.com/questions/251705/how-can-i-use-a-new-perl-module-without-install-permissions">How can I use a new Perl module without install permissions?</a><br>------------------------------------------------------------------ <br><h3> Answer 2980715 Chas. Owens: </h3><p>The easiest method I have found so far is to say</p>

<pre><code>wget -O- http://cpanmin.us | perl - -l ~/perl5 App::cpanminus local::lib
eval `perl -I ~/perl5/lib/perl5 -Mlocal::lib`
echo 'eval `perl -I ~/perl5/lib/perl5 -Mlocal::lib`' &gt;&gt; ~/.profile
echo 'export MANPATH=$HOME/perl5/man:$MANPATH' &gt;&gt; ~/.profile
</code></pre>

<p>This assumes your profile is named <code>.profile</code>, you may need to change that to be <code>.bash_profile</code>, <code>.bashrc</code>, etc.  After that you can install modules by saying</p>

<pre><code>cpanm Module::Name
</code></pre>

<p>and simply use them the same way you would if the were installed in the root directories.</p>

<hr>

<p>What follows is a brief explanation of what the commands above do.</p>

<p><code>wget -O- http://cpanmin.us</code> fetches the latest version of <code>cpanm</code> and prints it to <code>STDOUT</code> which is then piped to <code>perl - -l ~/perl5 App::cpanminus local::lib</code>.  The first <code>-</code> tells <code>perl</code> to expect the program to come in on <code>STDIN</code>, this makes <code>perl</code> run the version of <code>cpanm</code> we just downloaded.  <code>perl</code> passes the rest of the arguments to <code>cpanm</code>.  The <code>-l ~/perl5</code> argument tells <code>cpanm</code> where to install Perl modules, and the other two arguments are two modules to install.  <code>[App::cpanmins</code>]<a href="http://search.cpan.org/dist/App-cpanminus/lib/App/cpanminus.pm" rel="noreferrer">1</a> is the package that installs <code>cpanm</code>.  <a href="http://search.cpan.org/dist/local-lib/lib/local/lib.pm" rel="noreferrer"><code>local::lib</code></a> is a helper module that manages the environment variables needed to run modules in local directory.</p>

<p>After those modules are installed we run </p>

<pre><code>eval `perl -I ~/perl5/lib/perl5 -Mlocal::lib`
</code></pre>

<p>to set the environment variables needed to use the local modules and then</p>

<pre><code>echo 'eval `perl -I ~/perl5/lib/perl5 -Mlocal::lib`' &gt;&gt; ~/.profile
</code></pre>

<p>to ensure we will be able to use them the next time we log in.</p>

<pre><code>echo 'export MANPATH=$HOME/perl5/man:$MANPATH' &gt;&gt; ~/.profile
</code></pre>

<p>will hopefully cause man to find the man pages for your local modules.</p>
<h4> Comment 3101170 Juan A. Navarro: </h4>This has been working excellent for me. Just a small note to remove first any existing PERL5LIB environment variables already in your ~/.profile (or whatever). Otherwise local::lib will fail to install when running the first command.<br><h4> Comment 90638375 Chas. Owens: </h4>@HielkeWalinga Child processes cannot modify the environment of parent processes.  To deal with this, commands like  <code>perl -I ~&#47;perl5&#47;lib&#47;perl5 -Mlocal::lib</code> or <code>ssh-agent</code> that need to set environment variables for a parent process print out the commands that need to be run in the parent process and then you <code>eval</code> them.  You don&#39;t actually need to <code>eval</code> them though.  You could say <code>perl -I ~&#47;perl5&#47;lib&#47;perl5 -Mlocal::lib &gt; &#47;tmp&#47;commands; source &#47;tmp&#47;commands</code>, but the eval method is cleaner (no files to clean up or accidentally overwrite).<br><h4> Comment 90597756 Hielke Walinga: </h4>Why do you need to use <code>eval</code>?<br><h4> Comment 3101228 Chas. Owens: </h4>@juannavar Good point, I tend to install it on newly installed machines, so I don&#39;t run into that case.<br><h4> Comment 15732547 AndrewPK: </h4>Great example using wget instead of curl - many systems don&#39;t come with curl by default though they do wget, so this is helpful for those without root to install new packages.<br><h4> Comment 45678367 basic6: </h4>Great answer, thank you! Nice way to install cpanm to be able to install Perl packages locally. I think, in some environments, .bash_profile might be used rather than .profile.<br><h4> Comment 115518931 Jean Paul: </h4>For me this procedure was not enough because <code>cpanm</code> was still not in my path. I had to do <code>export PATH=$HOME&#47;perl5&#47;bin:$PATH</code> to put it in my path. After, the modules I installed with <code>cpanm</code> were not in the perl lib path: I had to to <code>export PERL5LIB=$HOME&#47;perl5&#47;lib&#47;perl5${PERL5LIB:+:$PERL5LIB}</code> to fix that.<br>------------------------------------------------------------------ <br><h3> Answer 2980321 DVK: </h3><p><a href="http://web.archive.org/web/20120427144232/http://perl.jonallen.info/writing/articles/install-perl-modules-without-root" rel="nofollow noreferrer">http://web.archive.org/web/20120427144232/http://perl.jonallen.info/writing/articles/install-perl-modules-without-root</a></p>

<p><a href="http://novosial.org/perl/life-with-cpan/non-root/" rel="nofollow noreferrer">http://novosial.org/perl/life-with-cpan/non-root/</a></p>

<p>The main step in both sets of instructions involves <a href="http://search.cpan.org/~mstrout/local-lib-1.006000/lib/local/lib.pm" rel="nofollow noreferrer">local::lib module</a></p>

<p>AFAIK, CPAN logic is contained in Perl module (CPAN.pm) which means you can also easily install the newer one in your local directory as you would with any other Perl module.</p>

<hr>

<p>Also, once you install your modules in non-standard location, check out these two questions on loading libraries from non-standard locations (some of the info is already available in the link above):</p>

<p><a href="https://stackoverflow.com/questions/2526520/how-does-a-perl-program-know-where-to-find-the-file-containing-perl-module-it-use">How does a Perl program know where to find the file containing Perl module it uses?</a></p>

<p><a href="https://stackoverflow.com/questions/2526804/how-is-perls-inc-constructed-aka-what-are-all-the-ways-of-affecting-where-per">How is Perl’s @INC constructed?</a> (aka What are all the ways of affecting where Perl modules are searched for?)</p>
<h4> Comment 3041916 Chas. Owens: </h4>There are at least four different ways to install modules from CPAN: by hand, the CPAN module (and its commandline equivalent <code>cpan</code>), the <code>CPANPLUS</code> module (and its commandline equivalent <code>cpanp</code>), and the newish App::cpanminus distribution that installs <code>cpanm</code>.  Of these, I find <code>cpanm</code> to be the easiest to install and use.  <code>cpan</code> and <code>cpanp</code> are installed by default, but require significant setup to work correctly.<br><h4> Comment 3041386 DVK: </h4>Disclosure - I authored both of SO questions linked in this answer.<br><h4> Comment 49062161 harschware: </h4>404: The requested URL /writing/articles/install-perl-modules-without-root was not found on this server.<br>------------------------------------------------------------------ <br><h3> Answer 8313215 Juan A. Navarro: </h3><p>For completeness, this is the installation process of <code>cpanm</code> on OSX if you want to keep your <code>perl5</code> under <code>~/Library</code>.</p>

<pre><code>curl -L http://cpanmin.us | perl - -l ~/Library/perl5 App::cpanminus local::lib
eval `perl -I ~/Library/perl5/lib/perl5 -Mlocal::lib=~/Library/perl5`
echo 'eval `perl -I ~/Library/perl5/lib/perl5 -Mlocal::lib=~/Library/perl5`' &gt;&gt; ~/.bash_profile
</code></pre>
------------------------------------------------------------------ <br><h3> Answer 41438072 Britton Kerin: </h3><p>If you want to be able to read man pages for the cpanminus-installed modules as well, you should also make sure the correct subdirectory of the chosen library path is in MANPATH.  So the above solution showing the installation process of cpanm needs the following additional command:</p>

<pre><code> export MANPATH=$HOME/Library/perl5/man:$MANPATH' &gt;&gt; ~/.bash_profile
</code></pre>
------------------------------------------------------------------ <br><h3> Answer 57852089 Yordan Georgiev: </h3><p>we have been using  <a href="https://github.com/YordanGeorgiev/qto/blob/master/src/bash/deployer/check-install-perl-modules.func.sh" rel="nofollow noreferrer">the following func</a> during the last 6 months on over 20 deployments successful automated deployments to aws ... called from the main provisioning <a href="https://github.com/YordanGeorgiev/qto/blob/master/doc/md/installations_doc.md#37-bootstrap-and-deploy-the-application-on-aws-instance" rel="nofollow noreferrer">as follows</a>, which is basically  just a copy paste of the answers above, but in a single re-usable bash script:</p>
<pre><code> #! /usr/bin/env bash                                                                                                                                                     │··  
                                                                                                                                                                           │··
  # a bash wrapper for check-installing required perl modules as non-root  
main(){                                                                                                                                                                  │··
     doSetVars                                                                                                                                                             │··
     doCheckInstallPreReqs                                                                                                                                                 │··
     perl $PRODUCT_INSTANCE_DIR/src/perl/my-perl-script.t                                                                                                                          │··
  }                                                                                                                                                                        │··
                                                                                                                                                                           │··
  doSetVars(){                                                                                                                                                             │··
     #set -x                                                                                                                                                               │··
     umask 022    ;                                                                                                                                                        │··
     set -u -o pipefail                                                                                                                                                    │··
     run_unit_bash_dir=$(perl -e 'use File::Basename; use Cwd &quot;abs_path&quot;; print dirname(abs_path(@ARGV[0]));' -- &quot;$0&quot;)                                                     │··
     export PRODUCT_INSTANCE_DIR=$run_unit_bash_dir/../..                                                                                                                  │··
  }                                                                                                                                                                        │··
                                                                                                                                                                           │··
  doCheckInstallPreReqs(){                                                                                                                                                 │··
     eval `perl -I ~/perl5/lib/perl5 -Mlocal::lib`                                                                                                                         │··
     perl -e '                                                                                                                                                             │··
        use JSON ;                                                                                                                                                         │··
        use Data::Printer;                                                                                                                                                 │··
        use Test::Most ;                                                                                                                                                   │··
        use Test::Mojo;                                                                                                                                                    │··
        use Data::Printer ;                                                                                                                                                │··
        use FindBin;                                                                                                                                                       │··
        use JSON::Parse ;                                                                                                                                                  │··
        use IPC::System::Simple ;                                                                                                                                          │··
        use Mojolicious ;                                                                                                                                                  │··
     ' || {                                                                                                                                                                │··
           curl -L http://cpanmin.us | perl - -l ~/perl5 App::cpanminus local::lib                                                                                         │··
           eval `perl -I ~/perl5/lib/perl5 -Mlocal::lib`                                                                                                                   │··
           echo 'eval `perl -I ~/perl5/lib/perl5 -Mlocal::lib`' &gt;&gt; ~/.bashrc                                                                                               │··
           cpanm --local-lib=~/perl5 local::lib &amp;&amp; eval $(perl -I ~/perl5/lib/perl5/ -Mlocal::lib)                                                                         │··
           export PERL_MM_USE_DEFAULT=1                                                                                                                                    │··
           cpanm JSON Data::Printer Test::Most Test::Mojo Data::Printer FindBin JSON::Parse \                                                                              │··
              IPC::System::Simple                                                                                                                                          │··
           sudo curl -L cpanmin.us | perl - Mojolicious                                                                                                                    │··
     }                                                                                                                                                                     │··
                                                                                                                                                                           │··
  }                                                                                                                                                                        │··
                                                                                                                                                                           │··
  main
</code></pre>
