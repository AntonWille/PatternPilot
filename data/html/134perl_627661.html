 <h2> Title: How can I output UTF-8 from Perl? </h2> <h4> Peter Conrey, question_id: 627661 </h4>Score: 134, Tags: {perl,unicode,utf-8} <br><p>I am trying to write a Perl script using the <code>utf8</code> pragma, and I'm getting unexpected results.  I'm using Mac OS X 10.5 (Leopard), and I'm editing with TextMate.  All of my settings for both my editor and operating system are defaulted to writing files in utf-8 format.</p>
<p>However, when I enter the following into a text file, save it as a &quot;.pl&quot;, and execute it, I get the friendly &quot;diamond with a question mark&quot; in place of the non-ASCII characters.</p>
<pre><code>#!/usr/bin/env perl -w

use strict;
use utf8;

my $str = 'Çirçös';
print( &quot;$str\n&quot; );
</code></pre>
<p>Any idea what I'm doing wrong? I expect to get 'Çirçös' in the output, but I get '�ir��s' instead.</p>
<h4> n00ki3, Id: 440232 Score: 1: </h4>Maybe its not the program .. i think its your shell oder your editor which does the output<br><h4> Daniel B&#246;hmer, Id: 95728841 Score: 0: </h4>All answers correctly answer your question how to set it explicitly to UTF8. I think you should be adjust to the locale settings of your terminal as shown in <a href="https://stackoverflow.com/a/14405949/498634">stackoverflow.com/a/14405949/498634</a>. The terminal might not be set to UTF8 and then data written to STDOUT in UTF8 <b>will be encoded incorrectly</b>!<br><h4> Eugen Konkov, Id: 106900263 Score: 0: </h4><a href="https://stackoverflow.com/a/6163129/4632019">Great answer</a> how to work with <code>utf8</code>:<br>------------------------------------------------------------------ <br><h3> Chris Lutz, Id: 627672, Score: 183: </h3><p><code>use utf8;</code> does not enable Unicode <em>output</em> - it enables you to type Unicode in your program. Add this to the program, before your <code>print()</code> statement:</p>

<pre><code>binmode(STDOUT, ":utf8");
</code></pre>

<p>See if that helps. That should make <code>STDOUT</code> output in UTF-8 instead of ordinary ASCII.</p>
<h4> Chas. Owens, Comment 583606 Score: 4: </h4>The utf8 pragma does not let you write your source in UNICODE, it forces understand of your source in the UTF-8 (or UTF-EBCDIC) encoding of UNICODE, an important distinction.<br><h4> ysth, Comment 441405 Score: 2: </h4>other ways: the open pragma ( <a href="http://search.cpan.org/perldoc/open" rel="nofollow noreferrer">search.cpan.org/perldoc/open</a> ), the -C switch ( <a href="http://perldoc.perl.org/perlrun.html#-C" rel="nofollow noreferrer">perldoc.perl.org/perlrun.html#-C</a> )<br><h4> Chris Lutz, Comment 440640 Score: 1: </h4>You&#39;re welcome. See also another correct answer: <a href="http://stackoverflow.com/questions/627661/writing-perl-code-in-utf8/627975#627975" title="writing perl code in utf8">stackoverflow.com/questions/627661/writing-perl-code-in-utf8&zwnj;&#8203;/&hellip;</a> and remember, TMTOWTDI. And @Paul - if you&#39;re writing UTF-8 to a file, you should probably use binmode() on that filehandle and make it &quot;proper&quot; UTF-8, but if it works..<br><h4> mirod, Comment 442115 Score: 1: </h4>FWIW here is the reason: strings that contains only latin1 (ISO-8859-1) characters, despite being stored more or less in utf8, will be output as latin1 by default. This way scripts from a pre-unicode era still work the same, even with a unicode-aware perl.<br><h4> Peter V. M&#248;rch, Comment 25478454 Score: 0: </h4>Slightly off-topic: In my opinion UTF-8 in perl is a <i>mess</i>! Sometimes it helps to know that one is not alone. See my post: <a href="http://www.perlmonks.org/?node_id=862973" rel="nofollow noreferrer">Why am I having so much trouble and pain with UTF-8 in perl?</a><br><h4> galactica, Comment 34538385 Score: 0: </h4>As per Perl 5.8.8, I can&#39;t get this working when trying to write Unicode strings into a file (I got warning like &quot;Wide character in print ...&quot;), although others say they did. The open pragma one works.<br><h4> Chris Lutz, Comment 441419 Score: 0: </h4>I shy away from the -C switch because not all Perls (i.e. ActivePerl) can process command-line switches well (to my knowledge),<br><h4> Paul Tomblin, Comment 440248 Score: 0: </h4>I didn&#39;t know about this (I&#39;ve only been putting UTF8 in a database, never printing it).  +1.<br>------------------------------------------------------------------ <br><h3> draegtun, Id: 627975, Score: 90: </h3><p>You can use the <a href="http://perldoc.perl.org/open.html" rel="noreferrer">open pragma</a>.  </p>

<p>For eg. below sets STDOUT, STDIN &amp; STDERR to use UTF-8....</p>

<pre><code>use open qw/:std :utf8/;
</code></pre>
<h4> draegtun, Comment 441044 Score: 2: </h4>BTW... I gave u +1. I think binmode(STDOUT, &#39;:utf8&#39;) is probably more correct in this situation.  &quot;use open&quot; has other good uses but I can&#39;t seem to find how u can set it to just encode STDOUT only?<br>------------------------------------------------------------------ <br><h3> Chas. Owens, Id: 772476, Score: 80: </h3><p><a href="http://www.perlfoundation.org/perl5/index.cgi?tmtowtdi" rel="noreferrer">TMTOWTDI</a>, chose the method that best fits how you work.  I use the environment method so I don't have to think about it.</p>

<p>In the <a href="http://perldoc.perl.org/perlrun.html#PERL_UNICODE" rel="noreferrer">environment</a>:</p>

<pre><code>export PERL_UNICODE=SDL
</code></pre>

<p>on the <a href="http://perldoc.perl.org/perlrun.html#*-C-[_number/list_]*" rel="noreferrer">command line</a>:</p>

<pre><code>perl -CSDL -le 'print "\x{1815}"';
</code></pre>

<p>or with <a href="http://perldoc.perl.org/functions/binmode.html" rel="noreferrer">binmode</a>:</p>

<pre><code>binmode(STDOUT, ":utf8");          #treat as if it is UTF-8
binmode(STDIN, ":encoding(utf8)"); #actually check if it is UTF-8
</code></pre>

<p>or with <a href="http://perldoc.perl.org/PerlIO.html" rel="noreferrer">PerlIO</a>:</p>

<pre><code>open my $fh, "&gt;:utf8", $filename
    or die "could not open $filename: $!\n";

open my $fh, "&lt;:encoding(utf-8)", $filename
    or die "could not open $filename: $!\n";
</code></pre>

<p>or with the <a href="http://perldoc.perl.org/open.html" rel="noreferrer">open pragma</a>:</p>

<pre><code>use open ":encoding(utf8)";
use open IN =&gt; ":encoding(utf8)", OUT =&gt; ":utf8";
</code></pre>
<h4> mklement0, Comment 36454380 Score: 2: </h4>+1 for a comprehensive answer; note that <code>SDL</code> is implied both with <code>-C</code> and <code>PERL_UNICODE</code>. The <code>use open &#39;:locale&#39;</code> pragma is also worth mentioning, because it is the in-script equivalent of <code>-C</code> and <code>export PER_UNICODE=</code>. Any of these 3 will give you UTF8 support for all input and output streams (whether files or stdin/stdout/stderr), assuming your environment&#39;s locale is UTF8-based. Finally, to also treat <i>source</i> code as UTF8, use the <code>use utf8;</code> pragma.<br><h4> vladr, Comment 87502743 Score: 1: </h4><code>perl -Mutf8 -CSDL -e &#39;...&#39;</code> allows to consume/output UTF-8 <i>as well</i> as use UTF-8 literals inside <code>-e</code> e.g. for a poor man&#39;s case folder: <code>perl -Mutf8 -CASDL -pe &#39;y&#47;ā&#225;ǎ&#224;ē&#233;ě&#232;ī&#237;ǐ&#236;ō&#243;ǒ&#242;ū&#250;ǔ&#249;ǖǘǚǜĀ&#193;Ǎ&#192;Ē&#201;Ě&#200;Ī&#205;Ǐ&#204;Ō&#211;Ǒ&#210;Ū&#218;Ǔ&#217;ǕǗǙǛ&#47;aaaaeeee&zwnj;&#8203;iiiioooouuuu&#252;&#252;&#252;&#252;AAAA&zwnj;&#8203;EEEEIIIIOOOOUUUU&#220;&#220;&#220;&#220;&zwnj;&#8203;&#47;&#39;</code><br>------------------------------------------------------------------ <br><h3> Hans Ginzel, Id: 25259608, Score: 2: </h3><p>You also want to say, that strings in your code are utf-8. See <a href="https://stackoverflow.com/questions/6162484/why-does-modern-perl-avoid-utf-8-by-default">Why does modern Perl avoid UTF-8 by default?</a>. So set not only <code>PERL_UNICODE=SDAL</code> but also <code>PERL5OPT=-Mutf8</code>.</p>
------------------------------------------------------------------ <br><h3> S&#233;rgio, Id: 14658425, Score: 1: </h3><p>Thanks, finally got an solution to not put utf8::encode all over code. 
To synthesize and complete for other cases, like write and read files in utf8 and also works with LoadFile of an YAML file in utf8</p>

<pre><code>use utf8;
use open ':encoding(utf8)';
binmode(STDOUT, ":utf8");

open(FH, "&gt;test.txt"); 
print FH "something éá";

use YAML qw(LoadFile Dump);
my $PUBS = LoadFile("cache.yaml");
my $f = "2917";
my $ref = $PUBS-&gt;{$f};
print "$f \"".$ref-&gt;{name}."\" ". $ref-&gt;{primary_uri}." ";
</code></pre>

<p>where cache.yaml is:</p>

<pre><code>---
2917:
  id: 2917
  name: Semanário
  primary_uri: 2917.xml
</code></pre>
------------------------------------------------------------------ <br><h3> nxadm, Id: 627709, Score: -3: </h3><p>do in your shell:
$ env |grep LANG</p>

<p>This will probably show that your shell is not using a utf-8 locale.</p>
<h4> jrockway, Comment 441260 Score: 2: </h4>This would be an orthogonal concern.  You need your Perl script to output correct data before you can worry about how your terminal emulator interprets it.<br><h4> Peter Conrey, Comment 440278 Score: 0: </h4>Actually, it was set to utf-8. The problem was that I was outputting to STDOUT without setting binmode to utf-8;<br>