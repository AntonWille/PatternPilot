 <h2> Title: Best way to require all files from a directory in ruby? </h2> <h3> Gaetan Dubar, question_id: 735073 </h3>Score: 382, Tags: {ruby,file,directory,require} <br><p>What's the best way to require all files from a directory in ruby ?</p>
------------------------------------------------------------------ <br><h3> Answer 735130 Sam Stokes: </h3><p>How about:</p>

<pre><code>Dir["/path/to/directory/*.rb"].each {|file| require file }
</code></pre>
<h4> Comment 546604 Sam Stokes: </h4>According to the Pickaxe, the .rb extension is optional.  Technically it changes the meaning: &quot;require &#39;foo.rb&#39;&quot; requires foo.rb, whereas &quot;require &#39;foo&#39;&quot; might require foo.rb, foo.so or foo.dll.<br><h4> Comment 45714849 sheldonh: </h4>@PeteHodgson&#39;s suggestion is inaccurate. Ruby&#39;s <code>require</code> is not confused by the presence or absence of the <code>.rb</code> extension. Tested on MRI 1.8.7-p374, 2.1.5 and 2.2.0 tested. This urban legend comes from Rails, where &quot;clever&quot; autoloading exhibited the behaviour he describes in older versions (and may still exhibit it).<br><h4> Comment 13072703 Andres Riofrio: </h4>@Pete, is this still true? See <a href="http://stackoverflow.com/questions/735073/best-way-to-require-all-files-from-a-directory-in-ruby#comment9237243_2231511">Rene&#39;s comment</a> below.<br><h4> Comment 14499507 user2398029: </h4>This might be obvious, but its worth noting that dropping the .rb will also require any non-.rb files in the dir, which might not be desired.<br><h4> Comment 546518 rampion: </h4>You&#39;ll need to drop the .rb before requiring.  Good other than that<br><h4> Comment 60199834 RngTng: </h4>make sure to sort files first, for not introducing randomness caused by OS and keep require order deterministic:  <code>Dir[&quot;&#47;path&#47;to&#47;directory&#47;*.rb&quot;].sort.each {|file| require file }</code><br><h4> Comment 32978410 JacobEvelyn: </h4>@louism I think the discussion is actually about dropping the <code>.rb</code> from the <code>require</code> portion: <code>Dir[&quot;&#47;path&#47;to&#47;directory&#47;*.rb&quot;].each {|file| require file[0..-4] }</code><br><h4> Comment 96098896 Adverbly: </h4>even more concise would be:           <code>Dir[&quot;&#47;path&#47;to&#47;directory&#47;*.rb&quot;].each(&amp;method(:require))</code><br>------------------------------------------------------------------ <br><h3> Answer 735458 jandot: </h3><p>If it's a directory relative to the file that does the requiring (e.g. you want to load all files in the lib directory):</p>

<pre><code>Dir[File.dirname(__FILE__) + '/lib/*.rb'].each {|file| require file }
</code></pre>

<p><strong>Edit:</strong> Based on comments below, an updated version:</p>

<pre><code>Dir[File.join(__dir__, 'lib', '*.rb')].each { |file| require file }
</code></pre>
<h4> Comment 14982729 Chris: </h4>It&#39;s probably safer to use File.join rather than making assumptions about forward/backward slashes: <code>Dir[File.join(File.dirname(__FILE__), &#39;lib&#39;, &#39;*.rb&#39;)].each {|file| require file }</code><br><h4> Comment 35848552 Christian Bankester: </h4>If you&#39;re using &gt;= ruby 2.0, you can use <code>__dir__</code> instead of <code>File.dirname(__FILE__)</code>.<br><h4> Comment 14954104 jspooner: </h4>You can also add all child directories like this <code>Dir[File.dirname(__FILE__) + &#39;&#47;support&#47;**&#47;*.rb&#39;].each {|file| require file }</code><br><h4> Comment 33129595 maasha: </h4>There is also require_relative<br><h4> Comment 46446683 David Moles: </h4>@maasha How do you use <code>require_relative</code> to require all files in a directory?<br><h4> Comment 17540629 grasingerm: </h4>@ChristopherPatuzzo you are a live saver. I couldn&#39;t figure out why the files were never loaded. &quot;\current\file\path/lib/*.rb&quot;<br>------------------------------------------------------------------ <br><h3> Answer 992140 Tony Arcieri: </h3><p>Try the require_all gem:</p>

<ol>
<li><a href="http://github.com/jarmo/require_all" rel="noreferrer">http://github.com/jarmo/require_all</a></li>
<li><a href="https://rubygems.org/gems/require_all" rel="noreferrer">https://rubygems.org/gems/require_all</a></li>
</ol>

<p>It lets you simply:</p>

<pre><code>require_all 'path/to/directory'
</code></pre>
<h4> Comment 97088676 Pere Joan Martorell: </h4>It doesn&#39;t have sense to bloat your app with gems that you can simply replace with a line of code. This increases the load time of your app and induces more bugs at long term.<br><h4> Comment 45714967 sheldonh: </h4>@panupan Just be aware that <code>require_all</code>&#39;s cyclic dependency resolution works around a problem in your source code: you have Ruby source files that do not require their dependencies. This shuts the door on scalpel loading, committing you to all-or-nothing loading. That&#39;s not a problem in small libraries, but it&#39;s a decision you should be making consciously.<br><h4> Comment 10386072 panupan: </h4>I needed to include all of my ActiveRecord models, the require_all gem figured out all of the dependencies and required them perfectly. Thanks!<br>------------------------------------------------------------------ <br><h3> Answer 2231511 Pete Hodgson: </h3><pre><code>Dir[File.dirname(__FILE__) + '/../lib/*.rb'].each do |file| 
  require File.basename(file, File.extname(file))
end
</code></pre>

<p>If you don't strip the extension then you may end up requiring the same file twice (ruby won't realize that "foo" and "foo.rb" are the same file). Requiring the same file twice can lead to spurious warnings (e.g. "warning: already initialized constant").</p>
<h4> Comment 9237243 Rene Saarsoo: </h4>My testing shows the same that Derek said: <code>require &quot;foo.rb&quot;; require &quot;foo&quot;;</code> will load <code>foo.rb</code> just once.<br><h4> Comment 5370795 Derek: </h4>Is this really the case? Documentation says: A feature will not be loaded if its name already appears in $&quot;. The file name is converted to an absolute path, so &quot;require &#39;a&#39;; require &#39;./a&#39;&quot; will not load a.rb twice. <a href="http://www.ruby-doc.org/core/classes/Kernel.html#M001418" rel="nofollow noreferrer">ruby-doc.org/core/classes/Kernel.html#M001418</a><br><h4> Comment 45714865 sheldonh: </h4>No. Ruby&#39;s <code>require</code> is not confused by the presence or absence of the <code>.rb</code> extension. Tested on MRI 1.8.7-p374, 2.1.5 and 2.2.0. This urban legend comes from Rails, where &quot;clever&quot; autoloading exhibited the behaviour described in older versions (and may still exhibit it).<br><h4> Comment 29275195 Yarin: </h4>@PeteHodgson- Can you back this up?<br>------------------------------------------------------------------ <br><h3> Answer 21693468 magicgregz: </h3><pre><code>Dir.glob(File.join('path', '**', '*.rb'), &amp;method(:require))
</code></pre>

<p>or alternatively, if you want to scope the files to load to specific folders:</p>

<pre><code>Dir.glob(File.join('path', '{folder1,folder2}', '**', '*.rb'), &amp;method(:require))
</code></pre>

<p><strong>explanation:</strong> </p>

<p><a href="http://ruby-doc.org/core-2.2.0/Dir.html#method-c-glob">Dir.glob</a> takes a block as argument.</p>

<p>method(:require) <a href="http://ruby-doc.org/core-1.9.3/Object.html#method-i-method">will return the require method.</a></p>

<p>&amp;method(:require) will convert the method to a bloc.</p>
<h4> Comment 35725746 Nate Symer: </h4>This is some beautiful code. I love how there are no visible blocks.<br><h4> Comment 38265287 Ivan Black: </h4><code>Dir.glob( File.join( File.dirname(__FILE__), &#39;{lib,addons}&#39;, &#39;subfolder&#39;, &#39;**&#39;, &#39;*.rb&#39; ), &amp;method(:require) )</code> eliminates dependence on platform (such as &#39;/&#39; or &#39;\&#39;). Works well. Thanks.<br>------------------------------------------------------------------ <br><h3> Answer 736237 Ryan McGeary: </h3><p>The best way is to add the directory to the load path and then <code>require</code> the basename of each file.  This is because you want to avoid accidentally requiring the same file twice -- often  not the intended behavior.  Whether a file will be loaded or not is dependent on whether <code>require</code> has seen the path passed to it before.  For example, this simple irb session shows that you can mistakenly require and load the same file twice.</p>

<pre><code>$ irb
irb(main):001:0&gt; require 'test'
=&gt; true
irb(main):002:0&gt; require './test'
=&gt; true
irb(main):003:0&gt; require './test.rb'
=&gt; false
irb(main):004:0&gt; require 'test'
=&gt; false
</code></pre>

<p>Note that the first two lines return <code>true</code> meaning the same file was loaded both times.  When paths are used, even if the paths point to the same location, <code>require</code> doesn't know that the file was already required.</p>

<p>Here instead, we add a directory to the load path and then require the basename of each *.rb file within.</p>

<pre><code>dir = "/path/to/directory"
$LOAD_PATH.unshift(dir)
Dir[File.join(dir, "*.rb")].each {|file| require File.basename(file) }
</code></pre>

<p>If you don't care about the file being required more than once, or your intention is just to load the contents of the file, perhaps <code>load</code> should be used instead of <code>require</code>.  Use load in this case, because it better expresses what you're trying to accomplish.  For example:</p>

<pre><code>Dir["/path/to/directory/*.rb"].each {|file| load file }
</code></pre>
<h4> Comment 113648467 Mayinx: </h4>This seems to be the best solution to require all files while avoiding any accidental double requiring of files - and should be marked as the accepted answer ...<br><h4> Comment 123987893 Nakilon: </h4>I feel like something has changed since 2009. <code>require</code> now needs <code>.&#47;</code> and <code>require_relative</code> realises those are paths to the same file.<br>------------------------------------------------------------------ <br><h3> Answer 6400831 user470069: </h3><pre><code>Dir[File.join(__dir__, "/app/**/*.rb")].each do |file|
  require file
end
</code></pre>

<p>This will work recursively on your local machine and a remote (Like Heroku) which does not use relative paths.</p>
------------------------------------------------------------------ <br><h3> Answer 21851294 Koen.: </h3><p>Instead of concatenating paths like in some answers, I use <code>File.expand_path</code>:</p>

<pre><code>Dir[File.expand_path('importers/*.rb', File.dirname(__FILE__))].each do |file|
  require file
end
</code></pre>

<p><strong>Update:</strong></p>

<p>Instead of using <code>File.dirname</code> you could do the following:</p>

<pre><code>Dir[File.expand_path('../importers/*.rb', __FILE__)].each do |file|
  require file
end
</code></pre>

<p>Where <code>..</code> strips the filename of <code>__FILE__</code>.</p>
<h4> Comment 36887872 mswieboda: </h4>this seems definitely the way to go, and most up to date answer, after trying all the rest, +1 for <code>File.expand_path</code><br><h4> Comment 41133467 nzifnab: </h4>I definitely prefer this answer to the accepted one.  Various <code>Rails.root.join</code> answers also work if you&#39;re in rails.<br>------------------------------------------------------------------ <br><h3> Answer 26048097 Dan Kohn: </h3><p>In Rails, you can do:</p>

<pre><code>Dir[Rails.root.join('lib', 'ext', '*.rb')].each { |file| require file }
</code></pre>

<p>Update: Corrected with suggestion of @Jiggneshh Gohel to remove slashes.</p>
<h4> Comment 40807219 DMKE: </h4>Since <code>Rails.root</code> is a <a href="http://ruby-doc.org/stdlib/libdoc/pathname/rdoc/index.html" rel="nofollow noreferrer"><code>Pathname</code></a> instance, you can do this in any Ruby environment, not just Rails (N.B. <code>Rails.root.join(&#39;lib&#47;ext&#47;*.rb&#39;)</code> reads a little nicer)<br><h4> Comment 40811324 Dan Kohn: </h4>Thanks for the recommendation; I edited to include your comment.<br><h4> Comment 50917388 Jignesh Gohel: </h4>Using a forward slash (/) for sub-directories under Rails.root, for e.g. <code>Rails.root.join(&#39;&#47;lib&#39;)</code> doesn&#39;t generate correct path. I found this one to work correctly: <code>Dir[Rails.root.join(&#39;lib&#39;, &#39;ext&#39;, &#39;*.rb&#39;)].each { |file| require file }</code><br><h4> Comment 54839705 Dan Kohn: </h4>@Jiggneshh Gohel I removed slashes as you suggested, thanks.<br>------------------------------------------------------------------ <br><h3> Answer 24153527 Jazz: </h3><p>I'm a few years late to the party, but I kind of like this one-line solution I used to get rails to include everything in app/workers/concerns:</p>

<p><code>Dir[ Rails.root.join *%w(app workers concerns *) ].each{ |f| require f }</code></p>
------------------------------------------------------------------ <br><h3> Answer 76043492 Mike Slinn: </h3><p>For Ruby older than 3.0, <a href="https://www.rubydoc.info/gems/rubocop/RuboCop/Cop/Lint/NonDeterministicRequireOrder" rel="nofollow noreferrer">Rubocop warns</a> against the accepted answer because load order is not deterministic for all OSes. Linux sorts upper and lower case differently than Mac or Windows. The following does what the OP requested for all versions of Ruby:</p>
<pre class="lang-rb prettyprint-override"><code>Dir['/path/to/directory/*.rb'].sort.each { |file| require file }
</code></pre>
<p>The following recurses through all subdirectories for all versions of Ruby:</p>
<pre class="lang-rb prettyprint-override"><code>Dir['/path/to/directory/**/*.rb'].sort.each { |file| require file }
</code></pre>
<p>Ruby 3.0 and later sort files consistently, so the following is all that is needed if you know that older Ruby versions will never be used:</p>
<pre class="lang-rb prettyprint-override"><code>Dir['/path/to/directory/*.rb'].each { |file| require file }
</code></pre>
<p>The following recurses through all subdirectories for Ruby 3.0 and later:</p>
<pre class="lang-rb prettyprint-override"><code>Dir['/path/to/directory/**/*.rb'].each { |file| require file }
</code></pre>
------------------------------------------------------------------ <br><h3> Answer 41585878 Aleksander: </h3><p>And what about: <code>require_relative *Dir['relative path']</code>?</p>
<h4> Comment 74132444 fabriciofreitag: </h4>Require relative doesn&#39;t take multiple files: <a href="http://ruby-doc.org/core-2.1.2/Kernel.html#method-i-require_relative" rel="nofollow noreferrer">ruby-doc.org/core-2.1.2/Kernel.html#method-i-require_relativ&zwnj;&#8203;e</a><br><h4> Comment 75376064 knut: </h4><i>The &#39;*&#39; changes arity to 1</i> - What do you mean with it? <code>require_relative *Dir[&#39;*.rb&#39;]</code> work, if there is only one ruby-script. But if multiple ruby scripts are found, you get <code>require_relative&#39;: wrong number of arguments (4 for 1) (ArgumentError)</code><br><h4> Comment 74807785 Aleksander: </h4>OK, but in my example it isn&#39;t. The &#39;*&#39; changes arity to 1. It works as multiple call to require_relative.<br>------------------------------------------------------------------ <br><h3> Answer 75883224 MGreenfield: </h3><p>All these answers are great. To add, if you want to do this automagically, you can use <a href="https://github.com/fxn/zeitwerk" rel="nofollow noreferrer">Zeitwerk</a>, which is what Rails uses to load files.</p>
<pre><code>require 'zeitwerk'
loader = Zeitwerk::Loader.new
loader.push_dir('main/src/dir')
loader.setup
</code></pre>
<p>Then everything has access to everything</p>
