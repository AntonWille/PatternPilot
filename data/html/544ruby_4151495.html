 <h2> Title: Should Gemfile.lock be included in .gitignore? </h2> <h3> aarona, question_id: 4151495 </h3>Score: 544, Tags: {ruby,git,version-control,bundler,gemfile} <br><p>I'm sort of new to bundler and the files it generates. I have a copy of a git repo from GitHub that is being contributed to by many people so I was surprised to find that bundler created a file that didn't exist in the repo and wasn't in the <code>.gitignore</code> list.</p>

<p>Since I have forked it, I know adding it to the repo won't break anything for the main repo, but if I do a pull request, will it cause a problem?</p>

<p>Should <code>Gemfile.lock</code> be included in the repository?</p>
<h4> Comment 28588749 Peter Berg: </h4>If you found your way here because you have Linux and Windows boxes sharing the same repo, see Joe Yang&#39;s answer. At the time of my writing this it is ranked third. Also see <a href="http://stackoverflow.com/questions/14034561/should-gemfile-lock-be-committed-to-source-control-on-windows" title="should gemfile lock be committed to source control on windows">stackoverflow.com/questions/14034561/&hellip;</a><br><h4> Comment 19387701 ripper234: </h4>Related: <a href="http://stackoverflow.com/questions/14034561/should-gemfile-lock-be-committed-to-source-control-on-windows" title="should gemfile lock be committed to source control on windows">stackoverflow.com/questions/14034561/&hellip;</a><br>------------------------------------------------------------------ <br><h3> Answer 4151540 rwilliams: </h3><p><strong>Update for 2022</strong> from <a href="https://stackoverflow.com/users/645491/trinitronx">TrinitronX
</a></p>
<blockquote>
<p>Fast-forward to 2021 and now <a href="https://bundler.io/v2.2/guides/faq.html#using-gemfiles-inside-gems" rel="noreferrer">Bundler docs</a> <a href="https://web.archive.org/web/20211223201450/https://bundler.io/v2.2/guides/faq.html#using-gemfiles-inside-gems" rel="noreferrer">[web archive]</a> now say to commit the Gemfile.lock inside a gem... ¯_(ツ)_/¯ I guess it makes sense for developers and ease of use when starting on a project. However, now CI jobs need to be sure to remove any stray Gemfile.lock files to test against other versions.</p>
</blockquote>
<p><strong>Legacy answer ~2010</strong></p>
<p>Assuming you're not writing a rubygem, Gemfile.lock should be in your repository. It's used as a snapshot of all your required gems and their dependencies. This way bundler doesn't have to recalculate all the gem dependencies each time you deploy, etc.</p>
<p>From cowboycoded's comment below:</p>
<blockquote>
<p>If you are working on a gem, then DO NOT check in your Gemfile.lock. If you are working on a Rails app, then DO check in your Gemfile.lock.</p>
</blockquote>
<p>Here's a nice <a href="https://yehudakatz.com/2010/12/16/clarifying-the-roles-of-the-gemspec-and-gemfile/" rel="noreferrer">article</a> explaining what the lock file is.</p>
<h4> Comment 5453137 johnmcaliley: </h4>Depends on what you are working on.  If you are working on a gem, then DO NOT check in your Gemfile.lock.  If you are working on a Rails app, then DO check in your Gemfile.lock.  More info here - <a href="http://yehudakatz.com/2010/12/16/clarifying-the-roles-of-the-gemspec-and-gemfile/" rel="nofollow noreferrer">yehudakatz.com/2010/12/16/&hellip;</a><br><h4> Comment 75432623 Ricardo Ruwer: </h4>Please don&#39;t do that!! Keep your Gemfile.lock where it is!  Like said <a href="https://github.com/plataformatec/devise/pull/3147" rel="nofollow noreferrer">here</a> and <a href="https://github.com/rails/rails/pull/18951#issuecomment-74888396" rel="nofollow noreferrer">here</a>.<br><h4> Comment 6850837 aarona: </h4>you should put what cowboycoded said in your answer re: gems.<br><h4> Comment 124565880 TrinitronX: </h4>Fast-forward to 2021 and now <a href="https://bundler.io/v2.2/guides/faq.html#using-gemfiles-inside-gems" rel="nofollow noreferrer">Bundler docs</a> &#91;<a href="https://web.archive.org/web/20211223201450/https://bundler.io/v2.2/guides/faq.html#using-gemfiles-inside-gems" rel="nofollow noreferrer">web archive</a>&#93; now say to commit the <code>Gemfile.lock</code> inside a gem... &#175;\_(ツ)_/&#175; I guess it makes sense for developers and ease of use when starting on a project.  However, now CI jobs need to be sure to remove any stray <code>Gemfile.lock</code> files to test against other versions.<br><h4> Comment 15246866 TrinitronX: </h4>Here&#39;s another <a href="http://viget.com/extend/bundler-best-practices" rel="nofollow noreferrer">very helpful Best Practices guide</a> for Bundler<br><h4> Comment 40403451 Ciro Santilli OurBigBook.com: </h4>So: should I develop a ruby gem with <code>bundle install; bundle exec</code> and gitignore the <code>Gemfile.lock</code>?<br><h4> Comment 11067202 Ross: </h4>Article link needs a new href.<br><h4> Comment 62909391 p.matsinopoulos: </h4>@rwilliams It seems that you are right that <code>Gemfile.lock</code> should not be checked in when building gems. However, a notable example of a gem that has its <code>Gemfile.lock</code> checked in is <code>rails</code> gem. What is your opinion on that?<br><h4> Comment 64912741 Jwan622: </h4>Why don&#39;t we commit the gemfile.lock with a gem? What&#39;s so bad about it? Say my gem depends on Rails 3... shouldn&#39;t I specify this as a dependency in my Gemfile and therefore Gemfile.lock?<br><h4> Comment 129139951 Nakilon: </h4>I thing it is very incorrect at all to edit the answer to the opposite from what it was after it was upvoted for so many years. If you change your mind by getting new reasons just make another answer. This is so misleading. Hundreds of people upvoted it because they didn&#39;t agree to check in the Gemfile.lock. It is wrong to use their votes for the opposite.<br>------------------------------------------------------------------ <br><h3> Answer 5360120 ndbroadbent: </h3><p>The real problem happens when you are working on an open-source Rails app that needs to have a configurable database adapter. I'm developing the Rails 3 branch of Fat Free CRM. 
My preference is postgres, but we want the default database to be mysql2. </p>

<p>In this case, <code>Gemfile.lock</code> still needs be checked in with the default set of gems, but I need to ignore changes that I have made to it on my machine. To accomplish this, I run:</p>

<pre><code>git update-index --assume-unchanged Gemfile.lock
</code></pre>

<p>and to reverse:</p>

<pre><code>git update-index --no-assume-unchanged Gemfile.lock
</code></pre>

<p>It is also useful to include something like the following code in your <code>Gemfile</code>. This loads the appropriate database adapter gem, based on your database.yml.</p>

<pre><code># Loads the database adapter gem based on config/database.yml (Default: mysql2)
# -----------------------------------------------------------------------------
db_gems = {"mysql2"     =&gt; ["mysql2", "&gt;= 0.2.6"],
           "postgresql" =&gt; ["pg",     "&gt;= 0.9.0"],
           "sqlite3"    =&gt; ["sqlite3"]}
adapter = if File.exists?(db_config = File.join(File.dirname(__FILE__),"config","database.yml"))
  db = YAML.load_file(db_config)
  # Fetch the first configured adapter from config/database.yml
  (db["production"] || db["development"] || db["test"])["adapter"]
else
  "mysql2"
end
gem *db_gems[adapter]
# -----------------------------------------------------------------------------
</code></pre>

<p>I can't say if this is an established best practice or not, but it works well for me.</p>
<h4> Comment 9246851 iconoclast: </h4>Very useful info... not sure why you&#39;ve only got 3 points and a less useful answer has 50-some points.  Oh, yeah, look at the datestamps.  (One of the great failures of SO is the disproportionate benefits that accrue to answering soon after the question is asked.)<br><h4> Comment 11219976 rwilliams: </h4>@iconoclast: I&#39;m really glad you posted what you did. I think that many folks who come to this post, myself included, are &quot;blinded&quot; by the question title. I realize now that my answer only answers a specific use case and not necessarily the right answer to this question. I will work on updating it in the near future. That said, the OP should have not marked my answer as correct if it didn&#39;t satisfy his/her needs.<br>------------------------------------------------------------------ <br><h3> Answer 6366523 Joe Yang: </h3><p>My workmates and I have different Gemfile.lock, because we use different platforms, windows and mac, and our server is linux. </p>

<p>We decide to remove Gemfile.lock in repo and create Gemfile.lock.server in git repo, just like database.yml. Then before deploy it on server, we copy Gemfile.lock.server to Gemfile.lock on server using cap deploy hook</p>
<h4> Comment 11965476 brad: </h4>I have an app that I develop in OSX and then have to deploy on a Windows server. Tracking Gemfile.lock with git proved to be a bad idea so it did go in my .gitignore file. A lot of gems require different versions for the different environments. Ideally you should avoid ever being in this situation but I had no choice (damn you I.T. department!)<br>------------------------------------------------------------------ <br><h3> Answer 4156735 oma: </h3><p>Agreeing with r-dub, keep it in source control, but to me, the real benefit is this:</p>

<p><em>collaboration in identical environments</em> (disregarding the windohs and linux/mac stuff). Before Gemfile.lock, the next dude to install the project might see all kinds of confusing errors, blaming himself, but he was just that lucky guy getting the next version of super gem, breaking existing dependencies.</p>

<p>Worse, this happened on the servers, getting untested version unless being disciplined and install exact version. Gemfile.lock makes this explicit, and it will explicitly tell you that your versions are different.</p>

<p>Note: remember to group stuff, as :development and :test</p>
------------------------------------------------------------------ <br><h3> Answer 16065706 user41871: </h3><p>The Bundler docs address this question as well:</p>

<p>ORIGINAL: <a href="http://gembundler.com/v1.3/rationale.html" rel="nofollow noreferrer">http://gembundler.com/v1.3/rationale.html</a></p>

<p>EDIT: <a href="http://web.archive.org/web/20160309170442/http://bundler.io/v1.3/rationale.html" rel="nofollow noreferrer">http://web.archive.org/web/20160309170442/http://bundler.io/v1.3/rationale.html</a></p>

<p>See the section called "Checking Your Code into Version Control":</p>

<blockquote>
  <p>After developing your application for a while, check in the
  application together with the Gemfile and Gemfile.lock snapshot. Now,
  your repository has a record of the exact versions of all of the gems
  that you used the last time you know for sure that the application
  worked. Keep in mind that while your Gemfile lists only three gems
  (with varying degrees of version strictness), your application depends
  on dozens of gems, once you take into consideration all of the
  implicit requirements of the gems you depend on.</p>
  
  <p>This is important: the Gemfile.lock makes your application a single
  package of both your own code and the third-party code it ran the last
  time you know for sure that everything worked. Specifying exact
  versions of the third-party code you depend on in your Gemfile would
  not provide the same guarantee, because gems usually declare a range
  of versions for their dependencies.</p>
  
  <p>The next time you run bundle install on the same machine, bundler will
  see that it already has all of the dependencies you need, and skip the
  installation process.</p>
  
  <p>Do not check in the .bundle directory, or any of the files inside it.
  Those files are specific to each particular machine, and are used to
  persist installation options between runs of the bundle install
  command.</p>
  
  <p>If you have run bundle pack, the gems (although not the git gems)
  required by your bundle will be downloaded into vendor/cache. Bundler
  can run without connecting to the internet (or the RubyGems server) if
  all the gems you need are present in that folder and checked in to
  your source control. This is an optional step, and not recommended,
  due to the increase in size of your source control repository.</p>
</blockquote>
------------------------------------------------------------------ <br><h3> Answer 68618147 Petrus Repo: </h3><p>Simple answer in the year 2021:
<strong>Gemfile.lock should be in the version control also for Rubygems</strong>. The accepted answer is now 11 years old.</p>
<p>Some reasoning here (cherry-picked from comments):</p>
<p>@josevalim <a href="https://github.com/heartcombo/devise/pull/3147#issuecomment-52193788" rel="noreferrer">https://github.com/heartcombo/devise/pull/3147#issuecomment-52193788</a></p>
<blockquote>
<p>The Gemfile.lock should stay in the repository because contributors and developers should be able to fork the project and run it using versions that are guaranteed to work.</p>
</blockquote>
<p>@rafaelfranca <a href="https://github.com/rails/rails/pull/18951#issuecomment-74888396" rel="noreferrer">https://github.com/rails/rails/pull/18951#issuecomment-74888396</a></p>
<blockquote>
<p>I don't think it is a good idea to ignore the lock file even for plugins.</p>
<p>This mean that a &quot;git clone; bundle; rake test&quot; sequence is not guarantee to be passing because one of yours dozens of dependencies were upgraded and made your code break. Also, as @chancancode said, it make a lot harder to bisect.</p>
</blockquote>
<p>Also Rails has Gemfile.lock in git:</p>
<ul>
<li><a href="https://github.com/rails/rails/commit/0ad6d27643057f2eccfe8351409a75a6d1bbb9d0" rel="noreferrer">https://github.com/rails/rails/commit/0ad6d27643057f2eccfe8351409a75a6d1bbb9d0</a></li>
</ul>
------------------------------------------------------------------ <br><h3> Answer 38964304 grosser: </h3><p>No Gemfile.lock means:</p>

<ul>
<li>new contributors cannot run tests because weird things fail, so they won't contribute or get failing PRs ... bad first experience. </li>
<li>you cannot go back to a x year old project and fix a bug without having to update/rewrite the project if you lost your local Gemfile.lock</li>
</ul>

<p>-> Always check in Gemfile.lock, make travis delete it if you want to be extra thorough <a href="https://grosser.it/2015/08/14/check-in-your-gemfile-lock/" rel="noreferrer">https://grosser.it/2015/08/14/check-in-your-gemfile-lock/</a></p>
------------------------------------------------------------------ <br><h3> Answer 18415064 Gediminas Šukys: </h3><p>A little late to the party, but answers still took me time and foreign reads to understand this problem. So I want to summarize what I have find out about the Gemfile.lock.</p>

<p>When you are building a Rails App, you are using certain versions of gems in your local machine. If you want to avoid errors in the production mode and other branches, you have to use that one Gemfile.lock file everywhere and tell bundler to <code>bundle</code> for rebuilding gems every time it changes.</p>

<p>If <code>Gemfile.lock</code> has changed on your production machine and Git doesn't let you <code>git pull</code>, you should write <code>git reset --hard</code> to avoid that file change and write <code>git pull</code> again.</p>
<h4> Comment 81132858 Thomas S.: </h4>If a file changes automatically, e.g. by a build process, it is a clear sign that it should not be added to version control.<br>------------------------------------------------------------------ <br><h3> Answer 63817289 David Hempy: </h3><p>The other answers here are correct: Yes, your Ruby app (not your Ruby gem) should include <code>Gemfile.lock</code> in the repo.  To expand on <em>why</em> it should do this, read on:</p>
<p>I was under the mistaken notion that each env (development, test, staging, prod...) each did a <code>bundle install</code> to build their own Gemfile.lock. My assumption was based on the fact that Gemfile.lock does not contain any grouping data, such as :test, :prod, etc. This assumption was <em>wrong</em>, as I found out in a painful local problem.</p>
<p>Upon closer investigation, I was confused why my Jenkins build showed fetching a particular gem (<code>ffaker</code>, FWIW) successfully, but when the app loaded and required ffaker, it said file not found. WTF?</p>
<p>A little more investigation and experimenting showed what the two files do:</p>
<p><em>First</em> it uses Gemfile.lock to go fetch all the gems, even those that won't be used in this particular env. <em>Then</em> it uses Gemfile to choose which of those fetched gems to actually use in this env.</p>
<p>So, even though it fetched the gem in the first step based on Gemfile.lock, it did NOT include in my :test environment, based on the groups in Gemfile.</p>
<p>The fix (in my case) was to move <code>gem 'ffaker'</code> from the :development group to the main group, so all env's could use it. (Or, add it only to :development, :test, as appropriate)</p>
